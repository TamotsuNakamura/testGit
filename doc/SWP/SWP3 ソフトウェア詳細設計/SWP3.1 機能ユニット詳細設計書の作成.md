# SWP3.1 機能ユニット詳細設計書の作成

**ソフトウェア・アーキテクチャ設計書の機能ユニット仕様をもとに実装可能なレベル（プログラムユニット）まで詳細化し、ソフトウェア詳細設計書としてまとめる。**

## 3.1.1 プログラムユニット分割

### 入力

[（SW105）](../SWP1%20ソフトウェア要求定義/SWP1.1%20ソフトウェア要求仕様書の作成.md)ソフトウェア要求仕様書
[（SW205）](../SWP2%20ソフトウェア・アーキテクチャ設計/SWP2.1%20ソフトウェア・アーキテクチャ設計書の作成.md)ソフトウェア・アーキテクチャ設計書

### 概要

機能ユニットをプログラムユニットに分割する。

### 出力

（SW301）プログラムユニット機能/構成設計書
<a id = "SW301"></a>

### 実施内容

---

**機能ユニットをプログラムユニットに分割し、プログラムユニットの構成と各々の機能を定義する。**

* プログラムユニットは、実装・コンパイルおよび単体テストを実施する最小レベルまで分割する。

### 注意すべき事項

---

* 分割の考慮点
  * データフロー（データを処理する流れ）に着目する。
  * 複数のプログラムユニットに共通の機能を洗い出して、共通機能として定義する。
  * プログラムユニットの独立性（カプセル化）や相互の結合度などに注意する。
  * テスト性、保守性、拡張性
  * レビューのしやすさ
  * 再利用性
  * 処理漏れや処理間での矛盾がないように注意する。

## 3.1.2 プログラムユニット設計

### 入力

[（SW205）](../SWP2%20ソフトウェア・アーキテクチャ設計/SWP2.1%20ソフトウェア・アーキテクチャ設計書の作成.md)ソフトウェア・アーキテクチャ設計書
[（SW301）](#SW301)プログラムユニット機能/構成設計書

### 概要

プログラムユニットの処理内容を、実装可能なレベルまで詳細化する。

### 出力

（SW302）プログラムユニット設計書
<a id = "SW302"></a>

### 参照情報

各ハードウェア仕様書

### 実施内容

---

1. プログラムユニットの処理内容を実装可能なレベルまで詳細化する  
   詳細化すべき事項としては以下のようなものがある。
   * ハードウェア制御方法、タイミング、設定値
   * OSシステムコール、利用機能（汎用ライブラリ、共通機能等）の引数値
   * 高速化が必要な処理はその条件と手法
   * 状態管理（状態遷移表等で、入力イベントに対してソフトウェアの振る舞いを決定するための状態を管理する）
   * エラー処理
   * リソース定義（ユニット内で使用するリソース）
   * システム初期化処理
1. 不具合を解析する際に利用する機能もプログラムユニットとして詳細内容を検討する  
   設計する事項としては、以下のようなものがある。
   * ハードウェア制御時の状態（特にエラー発生時の情報）
   * ソフトウェア実行状態の確認

### 注意すべき事項

---

* 共通に使用する値を抽出して、具体的な数値を定める（define値として使用する値）。ソフトウェア・アーキテクチャ設計で定義された項目がある場合は、その項目について具体的な数値を定める。共通に使用する値の例としては、以下のようなものがある。
  * メモリのサイズ（テーブル、バッファなど）
  * エラー値
  * コンパイル条件
* 非同期で動作するプログラムユニット間の排他、イベント等を考慮する。
* 要求定義やアーキテクチャ設計に従って、製品シリーズ化などを考慮し、ソフトウェアのコアの部分を構成するプログラムユニット、製品バリエーションに対応するプログラムユニットなどを明確に区分する。
  * プロダクトライン
* ユーザインタフェースを実現するプログラムユニットについては、ユーザの操作性（ユーザの誤操作をまねくことがないよう）などを考慮する。
* 求められる安全度のレベルを考慮する（正確性、検証性・耐故障性など）。

## 3.1.3 インタフェースの詳細化

### 入力

[（SW205）](../SWP2%20ソフトウェア・アーキテクチャ設計/SWP2.1%20ソフトウェア・アーキテクチャ設計書の作成.md)ソフトウェア・アーキテクチャ設計書
[（SW302）](#SW302)プログラムユニット設計書

### 概要

機能ユニット間およびプログラムユニット間のインタフェースを、実装可能なレベルまで詳細化する。

### 出力

（SW303）プログラムユニット・インタフェース設計書
<a id = "SW303"></a>

### 実施内容

---

**ソフトウェアを構成する個々の機能ユニット、プログラムユニットそれぞれの間のインタフェースを詳細に定義する**

1. 機能ユニット間インタフェースを詳細化する
   * アーキテクチャ設計で定義されたインタフェース仕様を実装可能なレベルまで詳細化する。  
　 以下について、構造、サイズ、意味、初期値を明確にする。
     * 機能ユニットの入力
     * 機能ユニットの出力
     * 参照・設定するメモリ（テーブル、バッファ等）
1. プログラムユニット間インタフェースを設計する
   * インタフェースを実装可能なレベルまで詳細化する。以下について、構造、サイズ、意味、初期値を明確にする。
     * プログラムユニットの入力
     * プログラムユニットの出力
     * 参照・設定するメモリ（テーブル、バッファ等）

### 注意すべき事項

---

* メモリ（テーブル、バッファ等）を割り込み処理で使用する場合、タイミング等による不整合が発生しないようにする。

## 3.1.4 メモリ量の見積もり

### 入力

[（SW205）](../SWP2%20ソフトウェア・アーキテクチャ設計/SWP2.1%20ソフトウェア・アーキテクチャ設計書の作成.md)ソフトウェア・アーキテクチャ設計書
[（SW301）](#SW301)プログラムユニット機能/構成設計書
[（SW302）](#SW302)プログラムユニット設計書
[（SW303）](#SW303)プログラムユニット・インタフェース設計書

### 概要

メモリ量の詳細見積もりを行い、実装可能か否か確認する。

### 出力

（SW304）メモリ使用量（メモ）
<a id = "SW304"></a>
### 実施内容

---

**ソフトウェアの実現に際して必要となるメモリ量を見積もる。**

1. メモリ量の詳細を見積もる。
   * メモリの詳細な使用量を見積もる。見積もりはメモリ種別ごとに算出する（ROM、RAM、スタックエリア等）
1. 実装可否を確認する。
   * メモリ種別ごとに実装可能か否か確認する。容量を超える場合は詳細設計の見直し、またはメモリ量の変更をハードウェア開発側と検討する。

### 注意すべき事項

---

* メモリ量見積もりでは以下に注意する。
  * 仕様変更・追加を考慮した容量か（余裕があるか）。
  * 不具合解析環境（エミュレータ等のエリア）を考慮した容量か。

## 3.1.5 ソフトウェア詳細設計書の作成

### 入力

[（SW301）](#SW301)プログラムユニット機能/構成設計書
[（SW302）](#SW302)プログラムユニット設計書
[（SW303）](#SW303)プログラムユニット・インタフェース設計書
[（SW304）](#SW304)メモリ使用量（メモ）
（SW309）ハードウェア仕様との整合性確認結果レポート（指摘事項反映の場合）

### 概要

ソフトウェア詳細設計の事項を整理し、ソフトウェア詳細設計書としてまとめる。

### 出力

（SW305）ソフトウェア詳細設計書

### 実施内容

---

**[（SW301）](#出力)~[（SW304）](#出力-3)の成果を取りまとめて[ソフトウェア詳細設計書（SW305）](#出力-4)を作成する。**

* ソフトウェア詳細設計の過程で出力された資料を整理・体系化して文書化する。
* 内部確認、ハードウェア仕様との整合性の確認等での指摘事項が適切に反映されていることも確認する。

### 注意すべき事項

---

* 文書化での留意点
  * 変更履歴を添付し、変更箇所を明示する。
  * 作成文書に関しての責任所在を明示する。
  * 作成文書は構成管理および変更管理にて確実に管理する。